require 'spec_helper'

describe "SRecord" do

  before :all do
    @srec = MemoryImage.new("examples/srec1.s19")
  end

  it "code_start_address method works" do
    @srec.start_address.should == 0x3F000410
  end

  it "to_a method works" do
    @srec.to_a.should == [
      [1056964640, 0x18F09FE5], [1056964644, 418422757], [1056964648, 418422757],
      [1056964652, 418422757], [1056964656, 418422757], [1056964660, 15737059],
      [1056964664, 351313893], [1056964668, 351313893], [1056965232, 4094033983],
      [1056965236, 270598208], [1056965240, 2013265983], [1056966064, 1609629488],
      [1056966068, 457771104], [1056966072, 1609629488], [1056966076, 440993888],
      [1056966384, 1883701248]
    ]
  end

  it "data_width_in_bytes option works" do
    data = @srec.to_a(data_width_in_bytes: 2)
    data[0].should == [1056964640, 0x18F0]
    data[1].should == [1056964642, 0x9FE5]
    data.size.should == 32
  end

  it "endianness_change option works" do
    @srec.to_a(endianness_change: true).should == [
      [1056964640, 0xE59FF018], [1056964644, 3852464152], [1056964648, 3852464152],
      [1056964652, 3852464152], [1056964656, 3852464152], [1056964660, 3810586624],
      [1056964664, 3852464148], [1056964668, 3852464148], [1056965232, 1056966388],
      [1056965236, 1073750288], [1056965240, 1056964728], [1056966064, 822079583],
      [1056966068, 1611155739], [1056966072, 822079583], [1056966076, 1611155738],
      [1056966384, 18288]
    ]
  end
end
